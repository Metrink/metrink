<!DOCTYPE html>
<html xmlns:wicket="http://wicket.apache.org">
<body>
	<wicket:extend>
		<form wicket:id="form" class="form-inline">
            <input type="submit" id="graph-button" wicket:id="graph-button" class="btn" />
            <div class="input-prepend">
                <a href="#" wicket:id="query-wizard-link" id="query-wizard-link" class="add-on"><i class="icon-wrench"></i></a> 
                <input type="text" id="search-query" wicket:id="search-query" placeholder='-30m m("device", "group", "name")'></input>
            </div>
            <button class="btn" wicket:id="save-dashboard" id="save-dashboard"><i class="icofont-save"></i> Dashboard</button>
    	</form>
    
        <div wicket:id="query-wizard"></div>

        <div id="query-examples" style="display:none">
            <ul class="unstyled">
                <li><span>-30m m("*", "cpu", "load")</span>
                    <span class="muted">CPU load across all devices for the last 30 minutes</span></li>
                <li><span>-30m m("*", "cpu", "load", -1d)</span>
                    <span class="muted">Identical to above, but with yesterdays data as well</span></li>
                <li><span>-30m m("*", "cpu", "load") &gt;| avg</span>
                    <span class="muted">Add a horizontal line displaying the average</span></li>
            </ul>
            <p class="muted">Click the search icon to load this sample query into the query bar.</p>
            <script>
                $(function() {
                    var copy = function() {
                        $('#search-query').val($(this).next().text());
                        return false;
                    };
                    $('#query-examples li').each(function() {
                        var copyButton = $('<a href="#"><i class="icofont-search"></i> </a>');
                        copyButton.click(copy);
                        $(this).prepend(copyButton);
                    });
                
                      $('#search-query').qtip({
                        content: {
                            title: '<i class="icofont-info-sign"></i>&nbsp;&nbsp;Examples',
                            text: $("#query-examples"),
                        },
                        hide: {
                            event: 'keydown',
                        },
                        show: {
                            event: 'click keydown',
                        },
                        events: {
                            show: function(event, api) {
                                if($('#search-query').val() != "") {
                                    try { event.preventDefault(); } catch(e) {}
                                }
                            }
                        },
                        style: {
                            classes: 'qtip-large qtip-bootstrap',
                            width: 600,
                        },
                        position: {
                            my: 'top left',
                            at: 'bottom left',
                            adjust: {
                                x: 5,
                            },
                        },
                      });
                });
            </script>
            <style>
                #query-examples ul li .muted {
                    left: 275px;
                }
            </style>
        </div>
        
        
        <!-- Auto-sizing for the input box -->
        <script type="text/javascript">
          var resizeSearchQuery = function() {
            // will break if there is right padding on the form
            var form = $('#search-query').parents('form');
            var right_max = form.offset().left + form.outerWidth();
            
            var search_query_left = $('#search-query').offset().left;
            var search_query_padding = $('#search-query').outerWidth() - $('#search-query').width();
            
            var search_right = $('#search-query').offset().left + $('#search-query').outerWidth();
            var dashboard_btn_left = $('#save-dashboard').offset().left + $('#save-dashboard').outerWidth();
            var allocated = dashboard_btn_left - search_right;
            
            var width = right_max - search_query_left - search_query_padding - allocated - 5; // magic number - dont know why
            console.log("%d %d %d %d", right_max, search_query_left, search_query_padding, allocated, width);
            
            $('#search-query').css('width', width + 'px');
          };
          
          // resize on laod
          $(resizeSearchQuery);
        </script>

        <!-- Needed for the pop-ups -->
        <style>
            .qtip-large {
                max-width: 1024px;
            }
        </style>

		<div wicket:id="graph-panel"></div>
    
	</wicket:extend>
</body>
</html>
